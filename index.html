<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>SweetsThief</title>
        <link rel="icon" href="res/favicon.png" type="image/png">
        <!-- Bootstrap -->
        <link rel="stylesheet" href="css/bootstrap.css" type="text/css">
        <link rel="stylesheet" href="css/index.css" type="text/css">
		
		<!-- Bootstrap -->
        <script src="js/jquery.js" type="text/javascript"></script>
        <script src="js/bootstrap.js" type="text/javascript"></script>
        <!-- script for sockets -->
        <script src="js/socket.io.js"></script>
		
		<link rel="stylesheet" href="jquery-ui.css" type="text/css">
		<link rel="stylesheet" href="jquery-ui.structure.css" type="text/css">
		<link rel="stylesheet" href="jquery-ui.theme.css" type="text/css">
		<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
		<script src="http://code.jquery.com/jquery-2.2.1.min.js"></script>
		<script src="jquery-ui.js"></script>
    </head>
    <body>
        <div id="container">
            <div id="main" class="items">
                <img src="res/bowl.png" type="image/png">
            </div>
            <aside id="chat" class="items">
                <section id="messages" class="chat-items">
                    <!-- messages -->
                </section>
                <div id="send" class="chat-items">
                    <form action="" id="formsend">
                        <div class="input-group">
                            <input id="send-message" class="form-control" autocomplete="off" placeholder="Send a message..."/>
                            <span class="input-group-btn">
                                <button class="btn btn-primary">Send</button>
                            </span>
                        </div>
                    </form>
                </div>
            </aside>
        </div>
        
        <!-- Popup when connecting -->
        <div id="dialog-form" title="Login !">
          <label for="pseudo">Pseudo</label>
          <input type="text" id="pseudo" placeholder="Votre pseudo" class="text">
          <div>Choose a color</div>
           <select id="couleur">
              <option value="lightblue">Lightblue</option>
              <option value="green">Green</option>
              <option value="red">Red</option>
              <option value="pink">Pink</option>
              <option value="orange">Orange</option>
              <option value="yellow">Yellow</option>
              <option value="sandybrown">Sandybrown</option>
              <option value="deepskyblue">Deepskyblue between lightred and green</option>
            </select>
        </div>
		<script>
		var socket = io();

		var pseudo;
		var color;
					 
		$(function()
		{
			var dialog = $( "#dialog-form" ).dialog({
				autoOpen: true,
				height: 260,
				width: 200,
				modal: true,
				buttons:
				{
					"Login": connect
				}
			});

			form = dialog.find("form").on("submit", function(event)
			{
				event.preventDefault();
			});

			$("#create-user").button().on("click", function()
			{
				dialog.dialog("open");
			});
		});

		function connect()
		{
			pseudo = $('#pseudo').val();
			
			var e = document.getElementById("color");
			couleur = e.options[e.selectedIndex].value;
			
			$('#dialog-form').dialog('close');
			socket.emit('new_client', pseudo);
		}

		//socket
		socket.on('chat message', function(data)
		{
			if (data.pseudo != pseudo)
			{
				insertMessage(data.pseudo, data.msg, data.couleur);
			}
		});

		socket.on('new_client', function(pseudo_nouveauclient)
		{
			if (pseudo_nouveauclient != pseudo)
			{
				newClient(pseudo_nouveauclient + ' has just connected !');
			}   
		});

		socket.on('list_user', function(TextListUser)
		{
			insertUser(TextListUser);
		}); 

		socket.on('get_pseudo', function()
		{
			socket.emit('get_pseudo', pseudo);
		}); 

		$("#formsend").submit(function()
		{
			var message = $('#send-message').val();
			if (message != "")
			{
				socket.emit('chat message', message, color);
				insertMessage(pseudo, message, color); // Show the message on the page
				$('#send-message').val('').focus();
			}
			return false;
		});


		// Ajoute un message dans la page
		function insertMessage(pseudo, message,couleur)
		{
			$('#messages').append('<p><span style="background-color:' + color + ';"><b>' + pseudo + ':</b></span> ' + message + '</p>');
		}

		function insertUser(TextListUser)
		{
			$("#listuser").html("");
			$('#listuser').append('<p><span style="background-color:"black">' + TextListUser + '</span></p>');
		}

		function newClient(pseudo)
		{
			$('#messages').append('<p><i><font color="red">' + pseudo + '</font></i></p>');
		}
		</script>
    </body>
</html>
